<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Moving from Hathi Trust records to  • hathidy</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Moving from Hathi Trust records to ">
<meta property="og:description" content="hathidy">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">hathidy</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">2.0.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/Flu.html">Moving from Hathi Trust records to </a>
    </li>
    <li>
      <a href="../articles/Hathidy.html">Getting wordcount data from the Hathi Trust with hathidy</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="Flu_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Moving from Hathi Trust records to</h1>
                        <h4 class="author">Ben Schmidt</h4>
            
            <h4 class="date">2021-06-07</h4>
      
      
      <div class="hidden name"><code>Flu.Rmd</code></div>

    </div>

    
    
<p>The Hathi Trust has made available 17 million volumes of text with word counts at the page level. <a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a></p>
<p>The purpose of this package is to allow you to quickly work with tidy-formatted data for any of these books. These features are useful input into a wide variety of tasks in natural language processing, visualization, and other areas.</p>
<div id="reading-historical-texts" class="section level1">
<h1 class="hasAnchor">
<a href="#reading-historical-texts" class="anchor"></a>Reading historical texts</h1>
<p>First, some imports. <code>hathidy</code> is this package: ggplot2 is for visualization, and <code>dplyr</code> and <code>tidytext</code> together supply a number of useful functions for working with wordcount data. I would simply import <code>tidyverse</code> here, which would take care of almost everything here, but generally they don’t want you to put it in package dependencies.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">hathidy</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span>
<span class="co">#&gt; ── Attaching packages ─────────────────────────────────────── tidyverse 1.3.1 ──</span>
<span class="co">#&gt; ✓ ggplot2 3.3.3     ✓ purrr   0.3.4</span>
<span class="co">#&gt; ✓ tibble  3.1.1     ✓ dplyr   1.0.5</span>
<span class="co">#&gt; ✓ tidyr   1.1.3     ✓ stringr 1.4.0</span>
<span class="co">#&gt; ✓ readr   1.4.0     ✓ forcats 0.5.1</span>
<span class="co">#&gt; ── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──</span>
<span class="co">#&gt; x dplyr::filter() masks stats::filter()</span>
<span class="co">#&gt; x dplyr::lag()    masks stats::lag()</span></code></pre></div>
<p>As an example, let’s take a volume of nursing data.</p>
<p>I originally fetched this data using the hathi package from ROpenSci, but that package has been abandoned.</p>
<p>Start with a seed volume, and move on to metadata.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="va">bibliography_entry</span> <span class="op">=</span> <span class="fu">hathi</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/hathi/man/hathi_bib.html">hathi_bib</a></span><span class="op">(</span>htid <span class="op">=</span> <span class="st">"uma.ark:/13960/t0dv2df4m"</span><span class="op">)</span><span class="op">$</span><span class="va">items</span>

<span class="co"># Keep only the Umass entries.</span>

<span class="va">htids</span> <span class="op">=</span> <span class="va">bibliography_entry</span><span class="op">$</span><span class="va">htid</span> <span class="op">%&gt;%</span>
  <span class="fu">keep</span><span class="op">(</span><span class="op">~</span><span class="va">.x</span> <span class="op">%&gt;%</span> <span class="fu">str_detect</span><span class="op">(</span><span class="st">"uma.ark"</span><span class="op">)</span><span class="op">)</span>

<span class="va">metadata</span> <span class="op">=</span> <span class="va">bibliography_entry</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">htid</span> <span class="op">%&gt;%</span> <span class="fu">str_detect</span><span class="op">(</span><span class="st">"uma.ark"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">mutate</span><span class="op">(</span>enumcron <span class="op">=</span> <span class="va">enumcron</span> <span class="op">%&gt;%</span> <span class="fu">str_replace_all</span><span class="op">(</span><span class="st">"[^0-9 ]"</span>, <span class="st">""</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">separate</span><span class="op">(</span><span class="va">enumcron</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"vol"</span>, <span class="st">"no"</span>, <span class="st">"year"</span><span class="op">)</span>, convert <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">select</span><span class="op">(</span><span class="va">htid</span>, <span class="va">vol</span>, <span class="va">no</span>, <span class="va">year</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">mutate</span><span class="op">(</span>month <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">vol</span> <span class="op">==</span> <span class="fl">10</span>, <span class="va">no</span><span class="op">+</span><span class="fl">4</span>, <span class="va">no</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">mutate</span><span class="op">(</span>date <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/ISOdatetime.html">ISOdate</a></span><span class="op">(</span><span class="va">year</span>, <span class="va">month</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>

<span class="va">metadata</span> <span class="op">%&gt;%</span> <span class="fu">write_feather</span><span class="op">(</span><span class="st">"../ext/data/nursing_volumes.feather"</span><span class="op">)</span>
  </code></pre></div>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">metadata_file</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"nursing_volumes.feather"</span>, package <span class="op">=</span> <span class="st">"hathidy"</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/apache/arrow/">arrow</a></span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Attaching package: 'arrow'</span>
<span class="co">#&gt; The following object is masked from 'package:utils':</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     timestamp</span>
<span class="va">metadata</span> <span class="op">=</span> <span class="fu"><a href="https://arrow.apache.org/docs/r//reference/read_feather.html">read_feather</a></span><span class="op">(</span><span class="va">metadata_file</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="va">a</span> <span class="op">=</span> <span class="fu"><a href="../reference/hathi_counts.html">hathi_counts</a></span><span class="op">(</span><span class="va">metadata</span><span class="op">$</span><span class="va">htid</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span>
<span class="co">#&gt; Saving downloaded books to /var/folders/84/dvp0h0kn22qcx_0z_hn_b36w0000gn/T//RtmpUNgmoO; to speed up subsequent runs and be polite to the HTRC servers, set a permanent local cache like 'options('hathidy_dir' = /Users/bschmidt/hathi-ef)'.</span>

<span class="va">page_counts</span> <span class="op">=</span> <span class="va">a</span> <span class="op">%&gt;%</span> <span class="fu">group_by</span><span class="op">(</span><span class="va">page</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu">summarize</span><span class="op">(</span>count <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">count</span><span class="op">)</span>, .groups<span class="op">=</span><span class="st">"drop"</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu">pull</span><span class="op">(</span><span class="va">count</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="fu"><a href="https://rdrr.io/r/base/options.html">options</a></span><span class="op">(</span>hathidy_dir <span class="op">=</span> <span class="st">"~/hathi-features/"</span><span class="op">)</span>

<span class="va">data</span> <span class="op">=</span> <span class="fu"><a href="../reference/hathi_counts.html">hathi_counts</a></span><span class="op">(</span><span class="va">metadata</span><span class="op">$</span><span class="va">htid</span><span class="op">)</span>

<span class="co"># The first volume in this set is notes.</span>

<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 6 x 4</span>
<span class="co">#&gt;    page token count htid                    </span>
<span class="co">#&gt;   &lt;int&gt; &lt;chr&gt; &lt;int&gt; &lt;chr&gt;                   </span>
<span class="co">#&gt; 1     1 ,        10 uma.ark:/13960/t8mc9ss6h</span>
<span class="co">#&gt; 2     1 .         4 uma.ark:/13960/t8mc9ss6h</span>
<span class="co">#&gt; 3     1 's        1 uma.ark:/13960/t8mc9ss6h</span>
<span class="co">#&gt; 4     1 0330      1 uma.ark:/13960/t8mc9ss6h</span>
<span class="co">#&gt; 5     1 1         2 uma.ark:/13960/t8mc9ss6h</span>
<span class="co">#&gt; 6     1 10        1 uma.ark:/13960/t8mc9ss6h</span></code></pre></div>
<p>Once the HTIDs are known, we can load the data in. Note the global directory at the front here. It’s off by default, again so this can live online: but I strongly recommend filling in this field whenever using the package. You can store features in the current working directory, (probably in a folder called “features”), or use a global one. If you think you might work with Hathi more than once, having a local location might make sense: but for reproducible research, you should store just the files used in this particular project. If you don’t specify <em>any</em> location, feature counts will be downloaded to a temporary directory and deleted at the end of the session, which is less than ideal. (Among other things, your code will take much, much longer to run on a second or third run.)</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">nursing</span> <span class="op">=</span> <span class="va">data</span> <span class="op">%&gt;%</span> <span class="fu">inner_join</span><span class="op">(</span><span class="va">metadata</span><span class="op">)</span>
<span class="co">#&gt; Joining, by = "htid"</span></code></pre></div>
<p>You can get an overview of just the words per page in these volumes. This instantly makes clear that there’s a difference between the last 6 volumes and the first six in how they treat notes.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">nursing</span> <span class="op">%&gt;%</span>
  <span class="fu">group_by</span><span class="op">(</span><span class="va">page</span>, <span class="va">htid</span>, <span class="va">date</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">summarize</span><span class="op">(</span>count<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">count</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">geom_tile</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x<span class="op">=</span><span class="va">page</span>, y <span class="op">=</span> <span class="va">date</span>, fill <span class="op">=</span> <span class="va">count</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">scale_fill_viridis_c</span><span class="op">(</span><span class="st">"Words on page"</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Words per page by volume."</span><span class="op">)</span>
<span class="co">#&gt; `summarise()` has grouped output by 'page', 'htid'. You can override using the `.groups` argument.</span></code></pre></div>
<p><img src="Flu_files/figure-html/unnamed-chunk-6-1.png" width="700"></p>
<p>When are they talking about the ‘flu’ here? We’ll look</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="va">nursing</span> <span class="op">%&gt;%</span> 
  <span class="va">ungroup</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">token</span> <span class="op">%&gt;%</span> <span class="fu">str_detect</span><span class="op">(</span><span class="st">"[Ff]lu"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">group_by</span><span class="op">(</span><span class="va">token</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="co"># Only words that appear more than twice</span>
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">count</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">2</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_point</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x<span class="op">=</span><span class="va">date</span>, y <span class="op">=</span> <span class="va">token</span>, color<span class="op">=</span><span class="va">year</span> <span class="op">%&gt;%</span> <span class="va">as.character</span><span class="op">)</span>, alpha <span class="op">=</span> <span class="fl">0.33</span>, position<span class="op">=</span><span class="st">"jitter"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">scale_color_brewer</span><span class="op">(</span>type<span class="op">=</span><span class="st">'qual'</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">labs</span><span class="op">(</span>title<span class="op">=</span><span class="st">"All words that use the regex '[Ff]lu'"</span>, subtitle <span class="op">=</span> <span class="st">"'Flu' is not used in this journal, and 'influenza' is concentrated in 1918-1919"</span><span class="op">)</span></code></pre></div>
<p><img src="Flu_files/figure-html/unnamed-chunk-7-1.png" width="700"></p>
<p>Using tidytext, we can add tf_idf scores to every column. Here’s a chart of the highest TF-IDF words distinguishing each volume.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="va">nursing</span> <span class="op">%&gt;%</span> 
  <span class="fu">group_by</span><span class="op">(</span><span class="va">date</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">mutate</span><span class="op">(</span>total_words <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">count</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">token</span> <span class="op">%&gt;%</span> <span class="va">tolower</span> <span class="op">==</span> <span class="st">"influenza"</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">summarize</span><span class="op">(</span>count <span class="op">=</span>  <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">count</span><span class="op">)</span>, rate <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">count</span><span class="op">)</span><span class="op">/</span><span class="va">total_words</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>  <span class="fu">geom_line</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x<span class="op">=</span><span class="va">date</span>, y <span class="op">=</span> <span class="va">rate</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Usage of 'Influenza' by issue"</span><span class="op">)</span></code></pre></div>
<p><img src="Flu_files/figure-html/unnamed-chunk-8-1.png" width="700"></p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="va">nursing</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">token</span> <span class="op">%&gt;%</span> <span class="va">tolower</span> <span class="op">==</span> <span class="st">"influenza"</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu">geom_point</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>y <span class="op">=</span> <span class="va">date</span>, x <span class="op">=</span> <span class="va">page</span>, size <span class="op">=</span> <span class="va">count</span>, alpha <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">labs</span><span class="op">(</span>
    title <span class="op">=</span> <span class="st">"The 'influenza' peaks after the epidemic are clustered at individual pages."</span>  
  <span class="op">)</span></code></pre></div>
<p><img src="Flu_files/figure-html/unnamed-chunk-9-1.png" width="700"></p>
<div id="integration-with-other-libraries" class="section level2">
<h2 class="hasAnchor">
<a href="#integration-with-other-libraries" class="anchor"></a>Integration with other libraries</h2>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/juliasilge/tidytext">tidytext</a></span><span class="op">)</span>

<span class="va">field</span> <span class="op">=</span> <span class="fu">quo</span><span class="op">(</span><span class="va">date</span><span class="op">)</span>

<span class="va">nursing</span> <span class="op">%&gt;%</span> 
  <span class="fu">mutate</span><span class="op">(</span>date <span class="op">=</span> <span class="va">date</span> <span class="op">%&gt;%</span> <span class="fu">lubridate</span><span class="fu">::</span><span class="fu"><a href="http://lubridate.tidyverse.org/reference/round_date.html">round_date</a></span><span class="op">(</span><span class="st">"year"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">group_by</span><span class="op">(</span><span class="op">!</span><span class="op">!</span><span class="va">field</span>, <span class="va">token</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">summarize</span><span class="op">(</span>count<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">count</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/tidytext/man/bind_tf_idf.html">bind_tf_idf</a></span><span class="op">(</span><span class="va">token</span>, <span class="op">!</span><span class="op">!</span><span class="va">field</span>, <span class="va">count</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="fu">str_detect</span><span class="op">(</span><span class="va">token</span>, <span class="st">"^[a-z]{4,}$"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">mutate</span><span class="op">(</span>rank <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rank.html">rank</a></span><span class="op">(</span><span class="op">-</span><span class="va">tf_idf</span>, ties.method <span class="op">=</span> <span class="st">"random"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">rank</span> <span class="op">&lt;=</span><span class="fl">5</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">geom_text</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>y<span class="op">=</span><span class="op">-</span><span class="va">rank</span>, label <span class="op">=</span> <span class="fu">str_c</span><span class="op">(</span><span class="va">rank</span>, <span class="st">". "</span>, <span class="va">token</span>, <span class="st">" ("</span>, <span class="va">count</span>, <span class="st">")"</span> <span class="op">)</span><span class="op">)</span>, x <span class="op">=</span> <span class="fl">0</span>, adj <span class="op">=</span> <span class="fl">0</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">facet_wrap</span><span class="op">(</span><span class="fu">vars</span><span class="op">(</span><span class="op">!</span><span class="op">!</span><span class="va">field</span><span class="op">)</span>, scales <span class="op">=</span> <span class="st">"free_y"</span><span class="op">)</span> <span class="op">+</span> <span class="fu">theme_void</span><span class="op">(</span><span class="op">)</span> 
<span class="co">#&gt; `summarise()` has grouped output by 'date'. You can override using the `.groups` argument.</span></code></pre></div>
<p><img src="Flu_files/figure-html/unnamed-chunk-10-1.png" width="700"></p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://quanteda.io">quanteda.textstats</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">quanteda.textplots</span><span class="op">)</span>

<span class="va">flu_pages</span> <span class="op">=</span> <span class="va">nursing</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">token</span> <span class="op">%&gt;%</span> <span class="va">tolower</span> <span class="op">==</span> <span class="st">"women"</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu">distinct</span><span class="op">(</span><span class="va">date</span>, <span class="va">page</span><span class="op">)</span>

<span class="va">quanteda_dfm</span> <span class="op">=</span> <span class="va">nursing</span> <span class="op">%&gt;%</span>
  <span class="fu">inner_join</span><span class="op">(</span><span class="va">flu_pages</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">mutate</span><span class="op">(</span>date <span class="op">=</span> <span class="fu">lubridate</span><span class="fu">::</span><span class="fu"><a href="http://lubridate.tidyverse.org/reference/round_date.html">floor_date</a></span><span class="op">(</span><span class="va">date</span>, <span class="fu">lubridate</span><span class="fu">::</span><span class="fu"><a href="http://lubridate.tidyverse.org/reference/period.html">years</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">group_by</span><span class="op">(</span><span class="va">token</span>, <span class="va">date</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">anti_join</span><span class="op">(</span><span class="fu">tidytext</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/tidytext/man/stop_words.html">stop_words</a></span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"token"</span> <span class="op">=</span> <span class="st">"word"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">summarize</span><span class="op">(</span>count <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">count</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/tidytext/man/document_term_casters.html">cast_dfm</a></span><span class="op">(</span><span class="va">date</span>, <span class="va">token</span>, <span class="va">count</span><span class="op">)</span>
<span class="co">#&gt; Joining, by = c("page", "date")</span>
<span class="co">#&gt; `summarise()` has grouped output by 'token'. You can override using the `.groups` argument.</span>

<span class="co"># Calculate keyness and determine 1910 as the target group</span>
<span class="va">result_keyness</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://quanteda.io/reference/textstat_keyness.html">textstat_keyness</a></span><span class="op">(</span><span class="va">quanteda_dfm</span>, target <span class="op">=</span> <span class="st">"1920-01-01"</span>, measure <span class="op">=</span> <span class="st">"lr"</span> <span class="op">)</span>

<span class="co"># Plot estimated word keyness</span>
<span class="fu"><a href="https://rdrr.io/pkg/quanteda.textplots/man/textplot_keyness.html">textplot_keyness</a></span><span class="op">(</span><span class="va">result_keyness</span><span class="op">)</span> <span class="op">+</span> <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Log-likelihood ratio comparing pre-1920 to post-1920 uses of the word 'influenza'"</span>,
                                        subtitle <span class="op">=</span>  <span class="st">"The later years are post-clinical studies of the epidemic "</span><span class="op">)</span></code></pre></div>
<p><img src="Flu_files/figure-html/unnamed-chunk-11-1.png" width="700"></p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="fu"><a href="https://rdrr.io/r/utils/object.size.html">object.size</a></span><span class="op">(</span><span class="va">nursing</span><span class="op">)</span> <span class="op">/</span> <span class="fl">1000000</span>
<span class="co">#&gt; 38.8 bytes</span></code></pre></div>
</div>
</div>
<div class="footnotes">
<hr>
<ol>
<li id="fn1"><p>Boris Capitanu, Ted Underwood, Peter Organisciak, Timothy Cole, Maria Janina Sarol, J. Stephen Downie (2016). The HathiTrust Research Center Extracted Feature Dataset (2.0) [Dataset]. HathiTrust Research Center,<a href="http://dx.doi.org/10.13012/J8X63JT3" class="uri">http://dx.doi.org/10.13012/J8X63JT3</a>.<a href="#fnref1" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Ben Schmidt.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
